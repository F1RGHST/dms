# DMS — Инструкция по запуску

Ниже описано, как быстро поднять весь стек на **Linux** и **Windows** с помощью скриптов `start.sh` и `start.bat`.

---

## Общие требования

- **Docker** (с поддержкой Compose V2)  
- **Git**  
- Права **root**/**sudo** на Linux или **Администратор** на Windows  

---

## 1. Клонирование репозитория

```bash
git clone https://github.com/ArooiD/dms.git
cd dms
```

---

## 2. Запуск на Linux

### ⚠️ Внимание!

При первом запуске необходимо настроить MinIO.

1. Сделайте скрипт исполняемым:  
   ```bash
   chmod +x start.sh
   ```
2. Запустите от имени **root** или через **sudo**:  
   ```bash
   sudo ./start.sh
   ```
   
**Первый запуск**:
- Создаёт `/etc/docker/daemon.json` с DNS-серверами  
- Перезапускает Docker  
- Собирает модули `storage` и `search` с помощью Maven  
- Собирает все образы сервисов  

**Дальнейшие запуски** просто выполняют:
```bash
docker compose up
```

---

## 3. Запуск на Windows

### ⚠️ Внимание!

При первом запуске необходимо настроить MinIO.

1. Откройте **Командную строку** (`cmd.exe`) от **Администратора**.  
2. Поместите `start.bat` в корень папки `dms`.  
3. Выполните:  
   ```bat
   start.bat
   ```
   
**Первый запуск**:
- Пишет `C:\ProgramData\Docker\config\daemon.json` с DNS-серверами  
- Перезапускает службу Docker Desktop  
- Собирает модули `storage` и `search`  
- Собирает образы всех сервисов  

**Дальнейшие запуски** сразу поднимают контейнеры командой:
```bat
docker compose up
```

---

## 4. Форсированная пересборка

Если нужно заново прогнать весь процесс, удалите флаг и запустите снова:

### Linux
```bash
rm .initialized
sudo ./start.sh
```

### Windows
```bat
del .initialized
start.bat
```

---

## Порты и сервисы

| Сервис    | Локальный порт → Внутри контейнера | Описание                        |
|-----------|-------------------------------------|---------------------------------|
| **web**   | 8080 → 3000                        | Frontend                        |
| **storage** | 8081 → 8080                      | Сервис хранения документов      |
| **search**  | 8082 → 8080                      | Поисковый сервис                |
| **ocr**     | 8083 → 5000                      | OCR-сервис (Tesseract + Poppler)|
| **postgres**| 5432                             | PostgreSQL (`dms` БД)           |
| **minio**   | 9000, 9090                       | Объектное хранилище MinIO       |

Все контейнеры объединены в сеть `app`, данные PostgreSQL и кэш Maven-зависимостей хранятся в named volumes.
