# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: –ú–æ–¥—É–ª—å `storage`

## –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
–ú–æ–¥—É–ª—å `storage` —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é —Å–∏—Å—Ç–µ–º—ã DMS –∏ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∑–∞–≥—Ä—É–∑–∫—É, —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –û–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º –æ–±—ä–µ–∫—Ç–æ–≤ MinIO –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —á–µ—Ä–µ–∑ REST API.

---

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- Java 17+
- Spring Boot 3+
- Spring Web
- Spring Actuator
- MinIO Java SDK
- Docker

---

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω–µ—á–Ω—ã–µ —Ç–æ—á–∫–∏ API

### 1. –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
**POST** `/api/files/upload`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞**:
- `file`: `multipart/form-data` ‚Äî —Ñ–∞–π–ª –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏

**–û—Ç–≤–µ—Ç**: `200 OK`
```json
{
  "filename": "example.pdf",
  "url": "http://storage:8080/api/files/example.pdf"
}
```

**–û—à–∏–±–∫–∏**:
- `400 Bad Request` ‚Äî —Ñ–∞–π–ª –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –∑–∞–ø—Ä–æ—Å–µ
- `500 Internal Server Error` ‚Äî –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤ MinIO

---

### 2. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
**GET** `/api/files/{filename}`

**–û—Ç–≤–µ—Ç**: `200 OK` (–±–∏–Ω–∞—Ä–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç)

**–û—à–∏–±–∫–∏**:
- `404 Not Found` ‚Äî —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- `500 Internal Server Error` ‚Äî –æ—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ MinIO

---

### 3. –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
**DELETE** `/api/files/{filename}`

**–û—Ç–≤–µ—Ç**: `204 No Content`

**–û—à–∏–±–∫–∏**:
- `404 Not Found` ‚Äî —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω
- `500 Internal Server Error` ‚Äî –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏

---

### 4. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤ (–µ—Å–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
**GET** `/api/files/list`

**–û—Ç–≤–µ—Ç**: `200 OK`
```json
[
  {
    "filename": "file1.pdf",
    "size": 123456,
    "lastModified": "2024-04-25T10:30:00Z"
  },
  ...
]
```

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è MinIO

### application.properties
```properties
minio.url=http://minio:9000
minio.access-key=your-access-key
minio.secret-key=your-secret-key
minio.bucket=dms-files
```

### ‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ!

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å MinIO:

1. –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∫–µ—Ç —Å –∏–º–µ–Ω–µ–º `files-pool` –≤—Ä—É—á–Ω—É—é (–µ—Å–ª–∏ –æ–Ω –Ω–µ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏).
2. –°–æ–∑–¥–∞–π—Ç–µ API-–∫–ª—é—á —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏:
   - **access-key**: `63UDU4sSMgtG8pjS754i`
   - **secret-key**: `5vtaetOewoevIj7uDXp2W7MR1EF5EFHr6x2GZZfI`

üí° –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–æ —ç—Ç–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (Volumes) —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É–¥–∞–ª–∏—Ç—å –∫–æ–º–∞–Ω–¥–æ–π:

```bash
docker compose down -v
```


### Docker-compose –ø—Ä–∏–º–µ—Ä —Å–µ—Ä–≤–∏—Å–∞ MinIO
```yaml
minio:
  image: minio/minio
  ports:
    - "9000:9000"
    - "9001:9001"
  environment:
    MINIO_ROOT_USER: your-access-key
    MINIO_ROOT_PASSWORD: your-secret-key
  command: server /data --console-address ":9001"
  volumes:
    - minio_data:/data

volumes:
  minio_data:
```

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∫–µ—Ç–∞
–ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è `FileServiceImpl` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –±–∞–∫–µ—Ç–∞ `dms-files`, –∏ –µ—Å–ª–∏ –æ–Ω –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Äî —Å–æ–∑–¥–∞—ë—Ç –µ–≥–æ.

---

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- –û–±—ä–µ–∫—Ç—ã –≤ MinIO —Ö—Ä–∞–Ω—è—Ç—Å—è —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏, –≤–æ –∏–∑–±–µ–∂–∞–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏–º–µ–Ω –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å UUID.
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ –∏ —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤ –Ω–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —Å—Ç–æ—Ä–æ–Ω–µ.
- –î–ª—è MinIO –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π persistent volume.
- –°–µ—Ä–≤–∏—Å –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –ø–æ—Å–ª–µ MinIO, –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å `depends_on` –≤ `docker-compose.yml`.

---

## –ü—Ä–∏–º–µ—Ä –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ `pom.xml`
```xml
<dependency>
  <groupId>io.minio</groupId>
  <artifactId>minio</artifactId>
  <version>8.5.6</version>
</dependency>
```

---

## –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏
| –ö–æ–¥ | –°–æ–æ–±—â–µ–Ω–∏–µ | –ü—Ä–∏—á–∏–Ω–∞ |
|-----|-----------|---------|
| 400 | Invalid file | –ó–∞–ø—Ä–æ—Å –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ–∞–π–ª–∞ |
| 404 | File not found | –§–∞–π–ª –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ MinIO |
| 500 | Upload error | –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è |

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã
–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—ã –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è ‚Äî –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –∫–æ–º–∞–Ω–¥–µ backend —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

